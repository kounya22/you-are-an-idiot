<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>hello!</title>
<style>
  /* 親ページのGIFをウィンドウいっぱいに表示 */
  #parentGif {
    width: 100vw;
    height: 100vh;
    object-fit: cover; /* ウィンドウに合わせて拡大縮小 */
    position: fixed;
    top: 0;
    left: 0;
    z-index: -1; /* 背景に */
  }
  body {
    margin: 0;
    overflow: hidden;
  }
  h1, p {
    position: relative;
    z-index: 1; /* 親GIFより前面に表示 */
    text-align: center;
    color: red;
  }
</style>
<script>
let popupInterval;
let windows = [];
let audio;

// ウィンドウを開く（タイトル hello!）
function openPopup() {
  let left = Math.floor(Math.random() * (screen.width - 250));
  let top = Math.floor(Math.random() * (screen.height - 250));

  let newWin = window.open(
    "about:blank",
    "_blank",
    `width=250,height=250,left=${left},top=${top}`
  );

  if (newWin && !newWin.closed) {
    newWin.document.write(`
      <h3 style='color:red; text-align:center;'>YOU ARE AN IDIOT!</h3>
      <img src="idiot.gif" style="width:200px; display:block; margin:0 auto;">
    `);
    newWin.document.title = "hello!"; // ウィンドウタイトルを hello! に
    windows.push(newWin);

    // ウィンドウ自体を動かす
    let dxWin = 5, dyWin = 3;
    setInterval(() => {
      if (!newWin || newWin.closed) return;
      let x = newWin.screenX;
      let y = newWin.screenY;
      let newX = x + dxWin;
      let newY = y + dyWin;
      if (newX < 0 || newX > screen.width - 250) dxWin *= -1;
      if (newY < 0 || newY > screen.height - 250) dyWin *= -1;
      newWin.moveTo(newX, newY);
    }, 20);
  }
}

// 無限ウィンドウスタート
function startPopups() {
  popupInterval = setInterval(openPopup, 1000);
}

// 停止処理
function stopPopups() {
  clearInterval(popupInterval);
  windows.forEach(win => {
    try { if (win && !win.closed) win.close(); } catch(e) {}
  });
  windows = [];
  if (audio) audio.pause();
  document.body.innerHTML = `
    <h1 style='color:green; text-align:center;'>STOPPED!</h1>
  `;
}

// 音楽再生
function startMusic() {
  audio = new Audio("idiot.mp3");
  audio.loop = true;
  audio.play().catch(() => {
    console.log("自動再生ブロック");
  });
}

// スペースキーで停止
document.addEventListener("keydown", function(event) {
  if (event.code === "Space") stopPopups();
});

// ページロードで開始
window.onload = function() {
  startPopups();
  startMusic();
};
</script>
</head>
<body>
<h1>YOU ARE AN IDIOT!</h1>
<p>親のタブ押してスペースキーでストップ.</p>

<!-- 親ページの背景GIF -->
<img id="parentGif" src="background.gif" alt="背景GIF">
</body>
</html>
